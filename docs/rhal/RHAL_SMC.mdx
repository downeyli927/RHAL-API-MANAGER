---
sidebar_position: 57
---

# RHAL_SMC

RHAL_SMC api

## Custom Data Types
### SMC_STS
```bash
typedef enum
{
    HAL_SMC_OK = 0,
    HAL_SMC_FAIL = -1,
    HAL_SMC_TIMEOUT = -2,
    HAL_SMC_ERR_NO_ICC = -3,
    HAL_SMC_ERR_ICC_DEACTIVATE = -4,
    HAL_SMC_ERR_IFD_DISABLED = -5,
    HAL_SMC_ERR_ATR_TIMEOUT = -6,
    HAL_SMC_ERR_EDC_OR_PARITY_ERROR = -7,
}SMC_STS;
```

### HAL_SMC_PARITY
```bash
typedef enum
{
    HAL_SMC_NO_PARITY = 0,
    HAL_SMC_ODD_PARITY,
    HAL_SMC_EVEN_PARITY,
}HAL_SMC_PARITY;
```

### HAL_SMC_VCC_LVL
```bash
typedef enum
{
    HAL_SMC_VCC_LVL_3V = 0,
    HAL_SMC_VCC_LVL_5V
}HAL_SMC_VCC_LVL;
```

### HAL_SMC_CONV
```bash
typedef enum
{
    HAL_SMC_CONV_AUTO = 0,
    HAL_SMC_CONV_DIRECT,
    HAL_SMC_CONV_INVERSE
}HAL_SMC_CONV;
```

### HAL_SMC_IFD_PARAM_ID
```bash
typedef enum
{
    HAL_SMC_IFD_PARAM_VCC_LVL = 0,
    HAL_SMC_IFD_PARAM_CLOCK,
    HAL_SMC_IFD_PARAM_ETU,
    HAL_SMC_IFD_PARAM_CONV,
    HAL_SMC_IFD_PARAM_PARITY,
    HAL_SMC_IFD_PARAM_GUARD_INTERVAL,
    HAL_SMC_IFD_PARAM_FLOW_CONTROL,          // used for SMC with Flow Control (ICAM SMC)
    HAL_SMC_IFD_PARAM_EXTENDED_IO_CONTROL,   // used for SMC with Extend IO Control (ICAM SMC)
}HAL_SMC_IFD_PARAM_ID;
```

### HAL_SMC_CARD_STATUS
```bash
typedef enum {
    HAL_SMC_CARD_REMOVED = 0,        // ICC does not exist
    HAL_SMC_CARD_DEACTIVATE,         // ICC exists, but has not been activated
    HAL_SMC_CARD_RESET,              // ICC is reseting and waiting for ATR
    HAL_SMC_CARD_RESET_TIMEOUT,      // ICC Reset failed, due to no ATR responsed
    HAL_SMC_CARD_ACTIVATE,           // ICC has been activated successfully
    HAL_SMC_CARD_UNKNOWN,            // ICC has some error...
}HAL_SMC_CARD_STATUS;
```

### HAL_SMC_PROTOCOL
```bash
typedef enum {
    HAL_SMC_PROTOCOL_T0 = 0,
    HAL_SMC_PROTOCOL_T1 = 1,
    HAL_SMC_PROTOCOL_T14 = 14,
    HAL_SMC_PROTOCOL_MAX,
}HAL_SMC_PROTOCOL;
```

### HAL_SMC_PROTOCOL_PARAM_ID
```bash
typedef enum
{
    HAL_SMC_PROTOCOL_PARAM_T1_IFSC = 0x100,                      // IFSC : Information Field Size of Card
    HAL_SMC_PROTOCOL_PARAM_T1_IFSD = 0x102,                      // IFSD : Information Field Size of Device
    HAL_SMC_PROTOCOL_PARAM_T1_EDC_ALGO = 0x101,                  // EDC mode : 0 : LRC, others: CRC
    HAL_SMC_PROTOCOL_PARAM_T1_SEQUENCE_COUNTER_ENABLE = 0x110,   // Sequence counter mode : 0 : Disable, 1 : Enable
    HAL_SMC_PROTOCOL_PARAM_T1_DATA_CHAINING = 0x111,             // Data Chaining mode : 0 : Disable , 1 : Enable
}HAL_SMC_PROTOCOL_PARAM_ID;
```

### HAL_SMC_PROTOCOL_PARAM_T1
```bash
typedef struct
{
    UINT8  flags;
    #define DISABLE_SEQUENCE_COUNTER        0x80
    #define DISABLE_DATA_CHAINING           0x40
    UINT8  ifsc;
}HAL_SMC_PROTOCOL_PARAM_T1;
```

### HAL_SMC_PROTOCOL_PARAM
```bash
typedef struct
{
    HAL_SMC_PROTOCOL     protocol;

    union
    {
        HAL_SMC_PROTOCOL_PARAM_T1 T1;
    };

}HAL_SMC_PROTOCOL_PARAM;
```

### HAL_SMC_IFD_PARAM
```bash
typedef struct
{
    unsigned long       clk;
    unsigned long       etu;
    HAL_SMC_VCC_LVL     vcc_lvl;
    HAL_SMC_CONV        conv;
    HAL_SMC_PARITY      parity;
    unsigned long       guard_interval;
}HAL_SMC_IFD_PARAM;
```

## Function Declaration
### RHAL_SMC_Open
```bash
void* RHAL_SMC_Open(UINT8 id);
```
Open a SMC IFD
<ParamTable
  items={[
    { name: 'id', type: 'UINT8', desc: 'SMC IFD id' },
  ]}
/>


### RHAL_SMC_Close
```bash
SMC_STS RHAL_SMC_Close(void*pSmc);
```
Close a SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
  ]}
/>


### RHAL_SMC_SetParam
```bash
SMC_STS RHAL_SMC_SetParam(void*pSmc, HAL_SMC_IFD_PARAM*p_param);
```
Set Parameter of a SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'p_param', type: 'HAL_SMC_IFD_PARAM*', desc: 'p_param to be used' },
  ]}
/>


### RHAL_SMC_GetParam
```bash
SMC_STS RHAL_SMC_GetParam(void*pSmc, HAL_SMC_IFD_PARAM*p_param);
```
Get Parameter of a SMC IFD


### RHAL_SMC_SetProtocol
```bash
SMC_STS RHAL_SMC_SetProtocol(void*pSmc, HAL_SMC_PROTOCOL Protocol);
```
Set Protocol of a SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'Protocol', type: 'HAL_SMC_PROTOCOL', desc: 'Protocol to be used' },
  ]}
/>

### RHAL_SMC_GetProtocol
```bash
SMC_STS RHAL_SMC_GetProtocol(void*pSmc, HAL_SMC_PROTOCOL*pProtocol);
```
Get Protocol of a SMC IFD


### RHAL_SMC_SetProtocolParam
```bash
SMC_STS RHAL_SMC_SetProtocolParam(void*pSmc, HAL_SMC_PROTOCOL_PARAM_ID Id, UINT32 Val);
```
Set Protocol parameter of a SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'Id', type: 'HAL_SMC_PROTOCOL_PARAM_ID', desc: 'Protocol Parameter ID' },
    { name: 'Val', type: 'UINT32', desc: 'Protocol Parameter Value' },
  ]}
/>


### RHAL_SMC_GetProtocolParam
```bash
SMC_STS RHAL_SMC_GetProtocolParam(void*pSmc, HAL_SMC_PROTOCOL_PARAM_ID Id, UINT32*pVal);
```
Get Protocol Parameter of a SMC IFD


### RHAL_SMC_SetPPS
```bash
SMC_STS RHAL_SMC_SetPPS(void*pSmc, UINT8 fi, UINT8 di);
```
Set PPS
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'fi', type: 'UINT8', desc: 'frequency indicator' },
    { name: 'di', type: 'UINT8', desc: 'baud rate indicator' },
  ]}
/>


### RHAL_SMC_GetCardStatus
```bash
SMC_STS RHAL_SMC_GetCardStatus(void*pSmc, HAL_SMC_CARD_STATUS*pStatus);
```
Get Card Status of a SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pStatus', type: 'HAL_SMC_CARD_STATUS*', desc: 'Status output' },
  ]}
/>

### RHAL_SMC_PollCardStatus
```bash
SMC_STS RHAL_SMC_PollCardStatus(void*pSmc, HAL_SMC_CARD_STATUS*pStatus);
```
Poll Card Status of a SMC IFD.
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pStatus', type: 'HAL_SMC_CARD_STATUS*', desc: 'Status output' },
  ]}
/>


### RHAL_SMC_Activate
```bash
SMC_STS RHAL_SMC_Activate(void*pSmc);
```
Activate a Smart card. (Power On)
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
  ]}
/>


### RHAL_SMC_Deactivate
```bash
SMC_STS RHAL_SMC_Deactivate(void*pSmc);
```
Deactivate a Smart card. (Power Off)


### RHAL_SMC_Reset
```bash
SMC_STS RHAL_SMC_Reset(void*pSmc, HAL_SMC_PROTOCOL Protocol);
```
Reset a Smart card.
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'Protocol', type: 'HAL_SMC_PROTOCOL', desc: 'Protocol to be used' },
  ]}
/>


### RHAL_SMC_GetATR
```bash
SMC_STS RHAL_SMC_GetATR(void* pSmc, UINT8* pBuff, UINT32 BuffSize, UINT32* pLen);
```
Get ATR from Smart card.
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pBuff', type: 'UINT8*', desc: 'output buffer' },
    { name: 'BuffSize', type: 'UINT32', desc: 'Buffer Size' },
    { name: 'pLen', type: 'UINT32*', desc: 'number of bytes of ATR' },
  ]}
/>


### RHAL_SMC_SetIfdByATR
```bash
SMC_STS RHAL_SMC_SetIfdByATR(void*pSmc, UINT8*pATR, UINT32 pATRLen);
```
Set Smart Card IFD by ATR
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pATR', type: 'UINT8*', desc: 'atr data ( if atr is NULL means using default ATR)' },
    { name: 'pATRLen', type: 'UINT32', desc: 'length o atr' },
  ]}
/>


### RHAL_SMC_Read
```bash
SMC_STS RHAL_SMC_Read(void*pSmc, UINT8*pBuff, UINT32 Len, UINT32*pRxLen, UINT32 Timeout);
```
Read Data from Smart card (bypass protocol)
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pBuff', type: 'UINT8*', desc: 'read data buffer' },
    { name: 'Len', type: 'UINT32', desc: 'length of bytes to be read' },
    { name: 'pRxLen', type: 'UINT32', desc: 'number of readed bytes' },
    { name: 'Timeout', type: 'UINT32', desc: 'wait time (in ms)' },
  ]}
/>


### RHAL_SMC_Write
```bash
SMC_STS RHAL_SMC_Write(void*pSmc, UINT8*pBuff, UINT32 Len);
```
Write Data to Smart card (bypass protocol)
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pBuff', type: 'UINT8*', desc: 'data to be written' },
    { name: 'Len', type: 'UINT32', desc: 'length of buff to be written' },
  ]}
/>


### RHAL_SMC_Transfer
```bash
SMC_STS RHAL_SMC_Transfer(void*pSmc, UINT8*pCAPDU, UINT32 APDULen, UINT8*pRAPDU, UINT32*pRAPDULen, UINT32 Timeout);
```
Do APDU layer data exchange
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pCAPDU', type: 'UINT8*', desc: 'C-APDU to be sent' },
    { name: 'APDULen', type: 'UINT32', desc: 'Size of C-APDU' },
    { name: 'pRAPDU', type: 'UINT8*', desc: 'R-APDU buffer' },
    { name: 'pRAPDULen', type: 'UINT32*', desc: '(In) size of buffer to restire R-APDU / (OUT)size of received R-APDU  ' },
    { name: 'Timeout', type: 'UINT32', desc: 'command timeout' },
  ]}
/>


### RHAL_SMC_SetClockRate
```bash
SMC_STS RHAL_SMC_SetClockRate(void*pSmc, ULONG ClockHz);
```
Set Clock Frequency of SMC IFD. 
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'ClockHz', type: 'ULONG', desc: 'Clock Frequency of IFD (in Hz)' },
  ]}
/>


### RHAL_SMC_GetClockRate
```bash
SMC_STS RHAL_SMC_GetClockRate(void*pSmc, ULONG*pClockHz);
```
Get Clock Frequency of SMC IFD. 


### RHAL_SMC_SetETU
```bash
SMC_STS RHAL_SMC_SetETU(void*pSmc, ULONG ETU);
```
Set ETU of SMC IFD. 
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'ETU', type: 'ULONG', desc: 'new ETU setting' },
  ]}
/>


### RHAL_SMC_GetETU
```bash
SMC_STS RHAL_SMC_GetETU(void*pSmc, ULONG*pETU);
```
Get ETU of SMC IFD. 
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'pETU', type: 'ULONG*', desc: 'current ETU output' },
  ]}
/>


### RHAL_SMC_SetVccLvl
```bash
SMC_STS RHAL_SMC_SetVccLvl(void*pSmc, HAL_SMC_VCC_LVL VccLvL);
```
Set VCC Level of SMC IFD. 
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'VccLvL', type: 'HAL_SMC_VCC_LVL', desc: 'new vcc level' },
  ]}
/>
:::danger[Take care]

The power level will be applied at the next SMC activation

:::


### RHAL_SMC_GetVccLvl
```bash
SMC_STS RHAL_SMC_GetVccLvl(void*pSmc, HAL_SMC_VCC_LVL*pVccLvl);
```
Get VCC Level of SMC IFD


### RHAL_SMC_SetConv
```bash
SMC_STS RHAL_SMC_SetConv(void*pSmc, HAL_SMC_CONV Conv);
```
Set Convention of SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'Conv', type: 'HAL_SMC_CONV', desc: 'set convention ' },
  ]}
/>

### RHAL_SMC_GetConv
```bash
SMC_STS RHAL_SMC_GetConv(void*pSmc, HAL_SMC_CONV*pConv);
```
Get Convention of SMC IFD


### RHAL_SMC_SetParity
```bash
SMC_STS RHAL_SMC_SetParity(void*pSmc, HAL_SMC_PARITY Parity);
```
Set Parity of SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'Parity', type: 'HAL_SMC_PARITY', desc: 'new Parity ' },
  ]}
/>

### RHAL_SMC_GetParity
```bash
SMC_STS RHAL_SMC_GetParity(void*pSmc, HAL_SMC_PARITY*pParity);
```
Get Current Parity setting of SMC IFD


### RHAL_SMC_SetGuardInterval
```bash
SMC_STS RHAL_SMC_SetGuardInterval(void*pSmc, ULONG GI);
```
Set Current Guard Interval of SMC IFD
<ParamTable
  items={[
    { name: 'pSmc', type: 'void*', desc: 'handle of a Smart Card IFD' },
    { name: 'GI', type: 'ULONG', desc: 'new Guard Interval (in ETU)' },
  ]}
/>


### RHAL_SMC_GetGuardInterval
```bash
SMC_STS RHAL_SMC_GetGuardInterval(void*pSmc, ULONG*pGI);
```
Get Current Guard Interval of SMC IFD


### RHAL_SMC_CardStatusStr
```bash
const char* RHAL_SMC_CardStatusStr(HAL_SMC_CARD_STATUS Status);
```
Return Card Status
